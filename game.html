
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>لعبة الذاكرة المغربية</title>
<style>
/* General Styles */
* {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
}

body {
    background-color: #fff8e1;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 20px;
    background-image: url("data:image/svg+xml,%3Csvg width='120' height='120' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cpath fill='%23b45309' fill-opacity='0.1' d='M0 0h60v60H0zm60 60h60v60H60z'/%3E%3Cpath stroke='%23b45309' stroke-opacity='0.15' stroke-width='2' d='M0 0l60 60m0-60L0 60m60 0l60 60m0-60l-60 60'/%3E%3Cpath stroke='%23b45309' stroke-opacity='0.15' stroke-width='2' d='M60 0v60m0 0v60m-60-60h60m0 0h60'/%3E%3Cpath stroke='%2316a34a' stroke-opacity='0.1' stroke-width='2' d='M30 0v120M90 0v120'/%3E%3Cpath stroke='%2316a34a' stroke-opacity='0.1' stroke-width='2' d='M0 30h120M0 90h120'/%3E%3C/g%3E%3C/svg%3E");
}

h1 {
    color: #b45309;
    margin-bottom: 20px;
    text-align: center;
    font-size: 2rem;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.2);
    background-color: white;
    padding: 10px 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    border: 2px solid #b45309;
    position: relative;
}

h1::before, h1::after {
    content: '';
    position: absolute;
    width: 30px;
    height: 30px;
    background-size: 100%;
    top: 50%;
    transform: translateY(-50%);
}

h1::before {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%23b45309' d='M50 0L0 50l50 50 50-50z'/%3E%3Cpath fill='%23d97706' d='M50 20L20 50l30 30 30-30z'/%3E%3Ccircle cx='50' cy='50' r='10' fill='%2316a34a'/%3E%3C/svg%3E");
    right: -40px;
}

h1::after {
    background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Cpath fill='%23b45309' d='M50 0L0 50l50 50 50-50z'/%3E%3Cpath fill='%23d97706' d='M50 20L20 50l30 30 30-30z'/%3E%3Ccircle cx='50' cy='50' r='10' fill='%2316a34a'/%3E%3C/svg%3E");
    left: -40px;
}

/* Game Container Styles */
.game-container {
    width: 100%;
    max-width: 600px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
}

.game-container::before {
    content: '';
    position: absolute;
    top: -10px;
    right: -10px;
    bottom: -10px;
    left: -10px;
    z-index: -1;
    background-image: url("data:image/svg+xml,%3Csvg width='80' height='80' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d97706' fill-opacity='0.1'%3E%3Cpath d='M0 0h40v40H0V0zm40 40h40v40H40V40zm0-40h2l-2 2V0zm0 4l4-4h2l-6 6V4zm0 4l8-8h2L40 10V8zm0 4L52 0h2L40 14v-2zm0 4L56 0h2L40 18v-2zm0 4L60 0h2L40 22v-2zm0 4L64 0h2L40 26v-2zm0 4L68 0h2L40 30v-2zm0 4L72 0h2L40 34v-2zm0 4L76 0h2L40 38v-2zm0 4L80 0v2L42 40h-2zm4 0L80 4v2L46 40h-2zm4 0L80 8v2L50 40h-2zm4 0l28-28v2L54 40h-2zm4 0l24-24v2L58 40h-2zm4 0l20-20v2L62 40h-2zm4 0l16-16v2L66 40h-2zm4 0l12-12v2L70 40h-2zm4 0l8-8v2l-6 6h-2zm4 0l4-4v2l-2 2h-2z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    border-radius: 15px;
}

/* Header Styles */
.header-controls {
    display: flex;
    justify-content: space-between;
    width: 100%;
    margin-bottom: 15px;
}

.lang-selector {
    display: flex;
    align-items: center;
    background-color: white;
    border-radius: 8px;
    padding: 5px 10px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border: 1px solid #d97706;
}

.lang-selector select {
    padding: 5px;
    border-radius: 5px;
    border: 1px solid #d97706;
    background-color: white;
    color: #b45309;
    cursor: pointer;
}

.sound-toggle {
    background-color: white;
    border-radius: 8px;
    padding: 5px 10px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border: 1px solid #d97706;
    color: #b45309;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 5px;
}

.sound-toggle i {
    font-size: 1.2rem;
}

/* Difficulty Selector */
.difficulty-selector {
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    text-align: center;
    margin-bottom: 20px;
    width: 100%;
    border: 5px solid transparent;
    border-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none'%3E%3Cpath stroke='%23b45309' stroke-width='2' d='M0,0 L100,0 L100,100 L0,100 Z'/%3E%3Cpath stroke='%23d97706' stroke-width='4' d='M10,10 L90,10 L90,90 L10,90 Z'/%3E%3Cpath stroke='%2316a34a' stroke-width='2' d='M20,20 L80,20 L80,80 L20,80 Z'/%3E%3Cpath stroke='%230c4a6e' stroke-width='4' d='M30,30 L70,30 L70,70 L30,70 Z'/%3E%3C/g%3E%3C/svg%3E") 30;
    position: relative;
    z-index: 1;
}

.game-modes {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 15px;
}

.mode-switch {
    position: relative;
    display: inline-block;
    width: 50px;
    height: 24px;
}

.mode-switch input {
    opacity: 0;
    width: 0;
    height: 0;
}

.mode-slider {
    position: absolute;
    cursor: pointer;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: #ccc;
    transition: .4s;
    border-radius: 24px;
}

.mode-slider:before {
    position: absolute;
    content: "";
    height: 16px;
    width: 16px;
    left: 4px;
    bottom: 4px;
    background-color: white;
    transition: .4s;
    border-radius: 50%;
}

input:checked + .mode-slider {
    background-color: #16a34a;
}

input:checked + .mode-slider:before {
    transform: translateX(26px);
}

.mode-text {
    margin-right: 10px;
    font-weight: 600;
    color: #b45309;
}

.difficulty-selector p {
    margin-bottom: 15px;
    font-size: 1.2rem;
}

.card-theme-selector {
    margin-top: 20px;
    margin-bottom: 15px;
}

.card-theme-options {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    gap: 10px;
    margin-top: 10px;
}

.card-theme-option {
    padding: 5px 10px;
    border-radius: 5px;
    border: 2px solid #d97706;
    background-color: #fff8e1;
    cursor: pointer;
    transition: all 0.3s ease;
}

.card-theme-option.active {
    background-color: #d97706;
    color: white;
    transform: scale(1.05);
}

.card-theme-option:hover {
    transform: translateY(-2px);
}

.btn-group {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-bottom: 20px;
}

.btn {
    padding: 8px 16px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    font-size: 1rem;
    transition: all 0.3s ease;
}

.btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.15);
}

.btn-start {
    background-color: #2563eb;
    color: white;
    padding: 10px 24px;
    font-size: 1.1rem;
    position: relative;
    overflow: hidden;
    border: 2px solid #1e40af;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
}

.btn-start:hover {
    background-color: #1d4ed8;
    transform: translateY(-2px);
    box-shadow: 0 6px 10px rgba(0, 0, 0, 0.15);
}

.btn-start::before {
    content: '';
    position: absolute;
    top: -10px;
    left: -10px;
    right: -10px;
    bottom: -10px;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.15'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    z-index: -1;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.btn-start:hover::before {
    opacity: 1;
}

.btn-help {
    background-color: #8b5cf6;
    color: white;
    margin-right: 10px;
}

.btn-help:hover {
    background-color: #7c3aed;
}

.btn-easy {
    background-color: #d1fae5;
    color: #065f46;
}

.btn-easy.active {
    background-color: #10b981;
    color: white;
}

.btn-medium {
    background-color: #fef3c7;
    color: #92400e;
}

.btn-medium.active {
    background-color: #d97706;
    color: white;
}

.btn-hard {
    background-color: #fee2e2;
    color: #991b1b;
}

.btn-hard.active {
    background-color: #dc2626;
    color: white;
}

/* Game Stats */
.game-stats {
    display: flex;
    justify-content: space-between;
    width: 100%;
    margin-bottom: 15px;
    font-weight: 600;
    color: #b45309;
    background-color: white;
    padding: 10px 15px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border: 2px solid #d97706;
    position: relative;
    overflow: hidden;
}

.game-stats::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: url("data:image/svg+xml,%3Csvg width='40' height='40' viewBox='0 0 80 80' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d97706' fill-opacity='0.05'%3E%3Cpath d='M0 0h40v40H0V0zm40 40h40v40H40V40zm0-40h2l-2 2V0zm0 4l4-4h2l-6 6V4zm0 4l8-8h2L40 10V8zm0 4L52 0h2L40 14v-2zm0 4L56 0h2L40 18v-2zm0 4L60 0h2L40 22v-2zm0 4L64 0h2L40 26v-2zm0 4L68 0h2L40 30v-2zm0 4L72 0h2L40 34v-2zm0 4L76 0h2L40 38v-2zm0 4L80 0v2L42 40h-2zm4 0L80 4v2L46 40h-2zm4 0L80 8v2L50 40h-2zm4 0l28-28v2L54 40h-2zm4 0l24-24v2L58 40h-2zm4 0l20-20v2L62 40h-2zm4 0l16-16v2L66 40h-2zm4 0l12-12v2L70 40h-2zm4 0l8-8v2l-6 6h-2zm4 0l4-4v2l-2 2h-2z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    z-index: 0;
    opacity: 0.8;
}

.timer-container {
    width: 100%;
    margin-bottom: 15px;
    background-color: white;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    border: 2px solid #d97706;
    padding: 5px;
    overflow: hidden;
}

.timer-bar {
    height: 20px;
    background-color: #16a34a;
    border-radius: 4px;
    transition: width 1s linear;
    position: relative;
}

.timer-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-weight: bold;
    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
}

/* Game Board */
.game-board {
    display: grid;
    gap: 10px;
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    width: 100%;
    position: relative;
    z-index: 1;
    /* Moroccan tile pattern background */
    background-image: url("data:image/svg+xml,%3Csvg width='120' height='120' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='zellige' width='40' height='40' patternUnits='userSpaceOnUse'%3E%3Cpath fill='%23f8fafc' d='M0 0h40v40H0z'/%3E%3Cpath fill='%23eff6ff' d='M20 0h20v20H20z'/%3E%3Cpath fill='%23f0f9ff' d='M0 20h20v20H0z'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='120' height='120' fill='url(%23zellige)'/%3E%3Cpath fill='none' stroke='%23b45309' stroke-opacity='0.1' stroke-width='1' d='M0 0h40v40H0zM40 40h40v40H40zM80 80h40v40H80zM0 80h40v40H0zM80 0h40v40H80zM40 0v40M80 0v40M0 40h40M40 40v40M80 40h40M40 80h40M80 80v40M0 80v40'/%3E%3Cpath fill='none' stroke='%2316a34a' stroke-opacity='0.05' stroke-width='1' d='M20 0v120M60 0v120M100 0v120M0 20h120M0 60h120M0 100h120'/%3E%3Cpath fill='none' stroke='%230e7490' stroke-opacity='0.05' stroke-width='1' d='M0 0l120 120M120 0L0 120'/%3E%3C/svg%3E");
    border: 5px solid transparent;
    border-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none'%3E%3Cpath stroke='%23b45309' stroke-width='2' d='M0,0 L100,0 L100,100 L0,100 Z'/%3E%3Cpath stroke='%23d97706' stroke-width='4' d='M10,10 L90,10 L90,90 L10,90 Z'/%3E%3Cpath stroke='%2316a34a' stroke-width='2' d='M20,20 L80,20 L80,80 L20,80 Z'/%3E%3C/g%3E%3C/svg%3E") 30;
}

/* Card Styles */
.card {
    background-color: #b45309;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 2rem;
    aspect-ratio: 1;
    transition: all 0.3s ease;
    transform-style: preserve-3d;
    position: relative;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.card:hover {
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    transform: translateY(-2px) rotateY(0deg);
}

.card.flipped {
    transform: rotateY(180deg);
    background-color: #fff8e1;
}

.card.matched {
    opacity: 0.7;
    box-shadow: 0 0 15px rgba(22, 163, 74, 0.5);
}

@keyframes matched-pulse {
    0% { transform: scale(1) rotateY(180deg); }
    50% { transform: scale(1.1) rotateY(180deg); box-shadow: 0 0 20px rgba(22, 163, 74, 0.8); }
    100% { transform: scale(1) rotateY(180deg); }
}

.matched-animation {
    animation: matched-pulse 0.6s ease-in-out;
}

.card-face {
    position: absolute;
    width: 100%;
    height: 100%;
    backface-visibility: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 8px;
}

/* Default theme */
.card-back {
    background-color: #b45309;
    transform: rotateY(0deg);
    background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='zellige-pattern' x='0' y='0' width='40' height='40' patternUnits='userSpaceOnUse'%3E%3Cpath fill='%23b45309' d='M0 0h40v40H0z'/%3E%3Cpath fill='%23d97706' d='M20 0L0 20v20h20l20-20V0H20z'/%3E%3Cpath fill='%23f59e0b' d='M15 15L0 30v10h10l20-20V10H20L15 15z'/%3E%3Cpath d='M30 30L20 40h20V30L30 30z' fill='%23b45309'/%3E%3Cpath d='M0 0v10l10-10H0z' fill='%23b45309'/%3E%3C/pattern%3E%3C/defs%3E%3Crect x='0' y='0' width='120' height='120' fill='url(%23zellige-pattern)'/%3E%3Cpath stroke='%23ffffff' stroke-opacity='0.1' stroke-width='1' d='M0 0h40v40H0zM40 40h40v40H40zM80 80h40v40H80zM0 80h40v40H0zM80 0h40v40H80z'/%3E%3C/svg%3E");
    border: 2px solid #92400e;
    box-shadow: inset 0 0 10px rgba(0, 0, 0, 0.3);
}

.card-front {
    background-color: #fff8e1;
    transform: rotateY(180deg);
    background-image: url("data:image/svg+xml,%3Csvg width='120' height='120' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='moroccan-light' width='40' height='40' patternUnits='userSpaceOnUse'%3E%3Cpath fill='%23fff8e1' d='M0 0h40v40H0z'/%3E%3Cpath fill='%23fef3c7' d='M0 0h20v20H0zM20 20h20v20H20z'/%3E%3C/pattern%3E%3C/defs%3E%3Crect width='120' height='120' fill='url(%23moroccan-light)'/%3E%3Cpath fill='none' stroke='%23d97706' stroke-opacity='0.1' stroke-width='1' d='M20 0v120M60 0v120M100 0v120M0 20h120M0 60h120M0 100h120'/%3E%3C/svg%3E");
    border: 2px solid #d97706;
}

/* Zellige theme */
.theme-zellige .card-back {
    background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='zellige-blue' x='0' y='0' width='40' height='40' patternUnits='userSpaceOnUse'%3E%3Cpath fill='%230c4a6e' d='M0 0h40v40H0z'/%3E%3Cpath fill='%230ea5e9' d='M20 0L0 20v20h20l20-20V0H20z'/%3E%3Cpath fill='%2338bdf8' d='M15 15L0 30v10h10l20-20V10H20L15 15z'/%3E%3Cpath d='M30 30L20 40h20V30L30 30z' fill='%230c4a6e'/%3E%3Cpath d='M0 0v10l10-10H0z' fill='%230c4a6e'/%3E%3C/pattern%3E%3C/defs%3E%3Crect x='0' y='0' width='120' height='120' fill='url(%23zellige-blue)'/%3E%3Cpath stroke='%23ffffff' stroke-opacity='0.1' stroke-width='1' d='M0 0h40v40H0zM40 40h40v40H40zM80 80h40v40H80zM0 80h40v40H0zM80 0h40v40H80z'/%3E%3C/svg%3E");
    background-color: #0c4a6e;
    border: 2px solid #0284c7;
}

/* Pottery theme */
.theme-pottery .card-back {
    background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='pottery-pattern' x='0' y='0' width='40' height='40' patternUnits='userSpaceOnUse'%3E%3Cpath fill='%23854d0e' d='M0 0h40v40H0z'/%3E%3Cpath fill='%23a16207' d='M10 10h20v20H10z'/%3E%3Ccircle cx='20' cy='20' r='8' fill='%23ca8a04'/%3E%3Ccircle cx='20' cy='20' r='4' fill='%23eab308'/%3E%3C/pattern%3E%3C/defs%3E%3Crect x='0' y='0' width='120' height='120' fill='url(%23pottery-pattern)'/%3E%3Cpath stroke='%23facc15' stroke-opacity='0.2' stroke-width='1' d='M20 0v120M60 0v120M100 0v120M0 20h120M0 60h120M0 100h120'/%3E%3C/svg%3E");
    background-color: #854d0e;
    border: 2px solid #ca8a04;
}

/* Carpet theme */
.theme-carpet .card-back {
    background-image: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cdefs%3E%3Cpattern id='carpet-pattern' x='0' y='0' width='40' height='40' patternUnits='userSpaceOnUse'%3E%3Cpath fill='%23881337' d='M0 0h40v40H0z'/%3E%3Cpath fill='%23be123c' d='M0 0h5v40H0z M35 0h5v40h-5z M0 0h40v5H0z M0 35h40v5H0z'/%3E%3Cpath fill='%23e11d48' d='M10 10h20v20H10z'/%3E%3Cpath fill='%23f43f5e' d='M15 15h10v10H15z'/%3E%3C/pattern%3E%3C/defs%3E%3Crect x='0' y='0' width='120' height='120' fill='url(%23carpet-pattern)'/%3E%3C/svg%3E");
    background-color: #881337;
    border: 2px solid #be123c;
}

/* Win Screen */
.win-screen {
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
    text-align: center;
    width: 100%;
    border: 5px solid transparent;
    border-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none'%3E%3Cpath stroke='%2316a34a' stroke-width='2' d='M0,0 L100,0 L100,100 L0,100 Z'/%3E%3Cpath stroke='%2322c55e' stroke-width='4' d='M10,10 L90,10 L90,90 L10,90 Z'/%3E%3Cpath stroke='%23b45309' stroke-width='2' d='M20,20 L80,20 L80,80 L20,80 Z'/%3E%3C/g%3E%3C/svg%3E") 30;
    position: relative;
    /* Moroccan star pattern */
    background-image: url("data:image/svg+xml,%3Csvg width='90' height='90' viewBox='0 0 120 120' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none'%3E%3Cpath fill='%23fff' d='M0 0h120v120H0z'/%3E%3Cpath fill='%2316a34a' fill-opacity='0.07' d='M60 40L40 60H20L0 60v20l20 20h20l20-20v-20L40 40H60z'/%3E%3Cpath fill='%2316a34a' fill-opacity='0.07' d='M60 80l20-20h20l20-20v20l-20 20h-20l-20 20v-20z'/%3E%3Cpath fill='%2316a34a' fill-opacity='0.07' d='M120 60L100 40H80L60 40v20l20 20h20l20-20z'/%3E%3Cpath fill='%2316a34a' fill-opacity='0.07' d='M60 0L40 20H20L0 20v20l20-20h20l20-20z'/%3E%3Cpath fill='%2316a34a' fill-opacity='0.07' d='M120 20l-20-20H80L60 0v20l20-20h20l20 20z'/%3E%3Cpath fill='%2316a34a' fill-opacity='0.07' d='M120 100l-20 20H80l-20-20v-20l20 20h20l20-20z'/%3E%3Cpath fill='%2316a34a' fill-opacity='0.07' d='M0 100l20 20h20l20-20v-20L40 100H20L0 80z'/%3E%3C/g%3E%3C/svg%3E");
}

.celebration-animation {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 10;
}

@keyframes confetti-fall {
    0% { transform: translateY(-10vh) rotate(0); opacity: 1; }
    100% { transform: translateY(100vh) rotate(360deg); opacity: 0; }
}

.confetti {
    position: absolute;
    width: 10px;
    height: 10px;
    background-color: var(--color);
    border-radius: 50%;
    opacity: 0;
    animation: confetti-fall 3s ease-in-out forwards;
}

.medal {
    display: inline-block;
    padding: 10px 20px;
    margin: 10px;
    border-radius: 10px;
    font-weight: bold;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
}

.medal-gold {
    background: linear-gradient(45deg, #fbbf24, #f59e0b);
    color: #92400e;
    border: 2px solid #f59e0b;
}

.medal-silver {
    background: linear-gradient(45deg, #e5e7eb, #d1d5db);
    color: #374151;
    border: 2px solid #9ca3af;
}

.medal-bronze {
    background: linear-gradient(45deg, #c2410c, #9a3412);
    color: #fff;
    border: 2px solid #c2410c;
}

.win-title {
    color: #16a34a;
    margin-bottom: 15px;
    font-size: 1.5rem;
    text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.1);
    position: relative;
    display: inline-block;
}

.win-title::before, .win-title::after {
    content: '✨';
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
}

.win-title::before {
    right: -30px;
}

.win-title::after {
    left: -30px;
}

.win-stats {
    margin-bottom: 20px;
    font-size: 1.2rem;
}

.score-container {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 20px;
    background-color: rgba(22, 163, 74, 0.1);
    padding: 15px;
    border-radius: 10px;
    border: 2px dashed #16a34a;
}

.score-title {
    font-weight: bold;
    margin-bottom: 10px;
    color: #16a34a;
}

.score-value {
    font-size: 2rem;
    font-weight: bold;
    color: #b45309;
}

.highscores {
    max-height: 150px;
    overflow-y: auto;
    margin-bottom: 20px;
    width: 100%;
    border: 1px solid #e5e7eb;
    border-radius: 8px;
}

.highscore-item {
    display: flex;
    justify-content: space-between;
    padding: 8px 15px;
}

.highscore-item:nth-child(odd) {
    background-color: rgba(209, 250, 229, 0.3);
}

.btn-reset {
    background-color: #ef4444;
    color: white;
    margin-top: 15px;
}

.btn-reset:hover {
    background-color: #dc2626;
}

.btn-share {
    background-color: #6366f1;
    color: white;
    margin-top: 15px;
    margin-right: 10px;
}

.btn-share:hover {
    background-color: #4f46e5;
}

/* Instructions Modal */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-color: rgba(0, 0, 0, 0.5);
    z-index: 100;
    justify-content: center;
    align-items: center;
}

.modal-content {
    background-color: white;
    padding: 20px;
    border-radius: 10px;
    max-width: 80%;
    max-height: 80vh;
    overflow-y: auto;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
    border: 5px solid transparent;
    border-image: url("data:image/svg+xml,%3Csvg width='100' height='100' viewBox='0 0 100 100' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none'%3E%3Cpath stroke='%23b45309' stroke-width='2' d='M0,0 L100,0 L100,100 L0,100 Z'/%3E%3Cpath stroke='%23d97706' stroke-width='4' d='M10,10 L90,10 L90,90 L10,90 Z'/%3E%3C/g%3E%3C/svg%3E") 30;
    position: relative;
}

.modal-close {
    position: absolute;
    top: 10px;
    right: 10px;
    font-size: 1.5rem;
    color: #b45309;
    cursor: pointer;
    background: none;
    border: none;
}

.modal-title {
    color: #b45309;
    margin-bottom: 15px;
    padding-bottom: 10px;
    border-bottom: 2px solid #f8fafc;
    font-size: 1.3rem;
}

.instruction-section {
    margin-bottom: 15px;
}

.instruction-section h3 {
    color: #16a34a;
    margin-bottom: 5px;
    font-size: 1.1rem;
}

.footer {
    margin-top: 20px;
    color: #b45309;
    font-size: 0.9rem;
    text-align: center;
    background-color: white;
    padding: 10px 15px;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    position: relative;
    border: 1px solid #d97706;
}

.footer::before {
    content: '';
    position: absolute;
    top: 2px;
    left: 2px;
    right: 2px;
    bottom: 2px;
    border: 1px dashed #d97706;
    border-radius: 6px;
    pointer-events: none;
}

/* Responsive Grid Layouts */
.grid-easy {
    grid-template-columns: repeat(3, 1fr);
}

.grid-medium {
    grid-template-columns: repeat(4, 1fr);
}

.grid-hard {
    grid-template-columns: repeat(4, 1fr);
}

/* Media Queries */
@media (max-width: 500px) {
    .btn-group {
        flex-direction: column;
    }
    
    .grid-medium, .grid-hard {
        grid-template-columns: repeat(3, 1fr);
    }
    
    .game-modes, .card-theme-options {
        flex-direction: column;
    }
}
</style>
</head>
<body>
<h1>لعبة الذاكرة المغربية <span style="font-size: 1.5rem;">🧠</span></h1>

<div class="game-container">
    <!-- Header Controls -->
    <div class="header-controls">
        <div class="lang-selector">
            <select id="languageSelect">
                <option value="ar">العربية</option>
                <option value="fr">Français</option>
                <option value="en">English</option>
            </select>
        </div>
        <button class="sound-toggle" id="soundToggle">
            <i class="sound-icon">🔊</i> <span class="sound-text">الصوت</span>
        </button>
    </div>

    <!-- Difficulty Selection Screen -->
    <div class="difficulty-selector" id="difficultyScreen">
        <div class="game-modes">
            <span class="mode-text">وضع ثنائي</span>
            <label class="mode-switch">
                <input type="checkbox" id="twoPlayerMode">
                <span class="mode-slider"></span>
            </label>
        </div>
        
        <p>اختر مستوى الصعوبة:</p>
        <div class="btn-group">
            <button class="btn btn-easy active" data-difficulty="easy">سهل</button>
            <button class="btn btn-medium" data-difficulty="medium">متوسط</button>
            <button class="btn btn-hard" data-difficulty="hard">صعب</button>
        </div>
        
        <div class="card-theme-selector">
            <p>اختر نمط البطاقات:</p>
            <div class="card-theme-options">
                <div class="card-theme-option active" data-theme="default">تقليدي</div>
                <div class="card-theme-option" data-theme="zellige">زليج</div>
                <div class="card-theme-option" data-theme="pottery">فخار</div>
                <div class="card-theme-option" data-theme="carpet">سجاد</div>
            </div>
        </div>
        
        <button class="btn btn-help" id="helpBtn">تعليمات</button>
        <button class="btn btn-start" id="startBtn">ابدأ اللعبة</button>
    </div>

    <!-- Game Screen (Hidden initially) -->
    <div id="gameScreen" style="display: none; width: 100%;">
        <div class="game-stats">
            <div>الحركات: <span id="moveCount">0</span></div>
            <div>اللاعب: <span id="currentPlayer">1</span></div>
            <div>الأزواج: <span id="pairsFound">0</span>/<span id="totalPairs">0</span></div>
        </div>
        
        <div class="timer-container">
            <div class="timer-bar" id="timerBar">
                <span class="timer-text" id="timerText">60</span>
            </div>
        </div>
        
        <div class="game-board" id="gameBoard"></div>
        
        <button class="btn btn-reset" id="resetBtn">إعادة ضبط</button>
    </div>

    <!-- Win Screen (Hidden initially) -->
    <div class="win-screen" id="winScreen" style="display: none;">
        <div class="celebration-animation" id="celebrationAnimation"></div>
        <h2 class="win-title">مبروك! لقد فزت!</h2>
        
        <div class="score-container">
            <div class="score-title">النتيجة النهائية</div>
            <div class="score-value" id="finalScore">0</div>
        </div>
        
        <p class="win-stats">
            عدد الحركات: <span id="finalMoves">0</span><br>
            الوقت المتبقي: <span id="finalTime">0</span> ثانية
        </p>
        
        <div id="medalContainer"></div>
        
        <div id="highscoreSection">
            <h3>أفضل النتائج:</h3>
            <div class="highscores" id="highscores"></div>
        </div>
        
        <button class="btn btn-share" id="shareBtn">مشاركة النتيجة</button>
        <button class="btn btn-start" id="playAgainBtn">العب مرة أخرى</button>
    </div>
    
    <!-- Instructions Modal -->
    <div class="modal" id="instructionsModal">
        <div class="modal-content">
            <button class="modal-close" id="closeInstructionsBtn">×</button>
            <h2 class="modal-title">كيف تلعب لعبة الذاكرة المغربية</h2>
            
            <div class="instruction-section">
                <h3>قواعد اللعبة:</h3>
                <p>- انقر على البطاقات لقلبها ومحاولة العثور على أزواج متطابقة.</p>
                <p>- عندما تجد زوجًا متطابقًا، ستبقى البطاقات مكشوفة.</p>
                <p>- حاول العثور على جميع الأزواج قبل انتهاء الوقت.</p>
                <p>- كلما قل عدد الحركات التي تستخدمها، زادت نقاطك.</p>
            </div>
            
            <div class="instruction-section">
                <h3>مستويات الصعوبة:</h3>
                <p>- <strong>سهل:</strong> 6 أزواج، وقت أطول.</p>
                <p>- <strong>متوسط:</strong> 8 أزواج، وقت متوسط.</p>
                <p>- <strong>صعب:</strong> 12 زوجًا، وقت أقصر.</p>
            </div>
            
            <div class="instruction-section">
                <h3>وضع اللعب الثنائي:</h3>
                <p>- يتناوب اللاعبان على قلب البطاقات.</p>
                <p>- عندما يجد اللاعب زوجًا، يحصل على نقطة ويستمر في اللعب.</p>
                <p>- يفوز اللاعب الذي يجد أكبر عدد من الأزواج.</p>
            </div>
            
            <div class="instruction-section">
                <h3>النصائح:</h3>
                <p>- حاول تذكر مواقع البطاقات التي رأيتها.</p>
                <p>- في الوضع الثنائي، انتبه لما يكشفه خصمك.</p>
                <p>- كن سريعًا لكن لا تتسرع - فالحركات الإضافية تقلل من نقاطك النهائية.</p>
            </div>
        </div>
    </div>
</div>

<p class="footer">لعبة الذاكرة المغربية - اختبر ذاكرتك مع رموز من الثقافة المغربية 🇲🇦</p>

<script>
// Main Game Class
// Main Game Class
class MoroccanMemoryGame {
    constructor() {
        // Game state
        this.cards = [];
        this.flippedCards = [];
        this.matchedPairs = [];
        this.moves = 0;
        this.difficulty = 'medium';
        this.cardTheme = 'default';
        this.isLocked = false;
        this.isTwoPlayerMode = false;
        this.currentPlayer = 1;
        this.playerScores = { 1: 0, 2: 0 };
        this.soundEnabled = true;
        this.language = 'ar';
        this.timeLeft = 60; // Default time
        this.timerInterval = null;
        this.score = 0;
        
        // DOM elements
        this.difficultyScreen = document.getElementById('difficultyScreen');
        this.gameScreen = document.getElementById('gameScreen');
        this.winScreen = document.getElementById('winScreen');
        this.gameBoard = document.getElementById('gameBoard');
        this.moveCount = document.getElementById('moveCount');
        this.currentPlayerDisplay = document.getElementById('currentPlayer');
        this.pairsFound = document.getElementById('pairsFound');
        this.totalPairs = document.getElementById('totalPairs');
        this.finalMoves = document.getElementById('finalMoves');
        this.finalScore = document.getElementById('finalScore');
        this.finalTime = document.getElementById('finalTime');
        this.timerBar = document.getElementById('timerBar');
        this.timerText = document.getElementById('timerText');
        this.highscoresContainer = document.getElementById('highscores');
        this.instructionsModal = document.getElementById('instructionsModal');
        this.soundToggle = document.getElementById('soundToggle');
        this.languageSelect = document.getElementById('languageSelect');
        this.twoPlayerMode = document.getElementById('twoPlayerMode');
        this.medalContainer = document.getElementById('medalContainer');
        
        // Languages data
        this.translations = {
            'ar': {
                'difficulty': 'اختر مستوى الصعوبة:',
                'easy': 'سهل',
                'medium': 'متوسط',
                'hard': 'صعب',
                'start': 'ابدأ اللعبة',
                'moves': 'الحركات:',
                'player': 'اللاعب:',
                'pairs': 'الأزواج:',
                'reset': 'إعادة ضبط',
                'congratulations': 'مبروك! لقد فزت!',
                'finalScore': 'النتيجة النهائية',
                'finalMoves': 'عدد الحركات:',
                'timeLeft': 'الوقت المتبقي:',
                'seconds': 'ثانية',
                'playAgain': 'العب مرة أخرى',
                'share': 'مشاركة النتيجة',
                'bestScores': 'أفضل النتائج:',
                'instructions': 'تعليمات',
                'cardTheme': 'اختر نمط البطاقات:',
                'themeDefault': 'تقليدي',
                'themeZellige': 'زليج',
                'themePottery': 'فخار',
                'themeCarpet': 'سجاد',
                'twoPlayerMode': 'وضع ثنائي',
                'sound': 'الصوت',
                'player1Wins': 'اللاعب 1 يفوز!',
                'player2Wins': 'اللاعب 2 يفوز!',
                'tie': 'تعادل!',
                'score': 'النتيجة:',
                'goldMedal': 'ميدالية ذهبية',
                'silverMedal': 'ميدالية فضية',
                'bronzeMedal': 'ميدالية برونزية',
                'gameOver': 'انتهى الوقت! حاول مرة أخرى.'
            },
            'fr': {
                'difficulty': 'Choisissez le niveau de difficulté:',
                'easy': 'Facile',
                'medium': 'Moyen',
                'hard': 'Difficile',
                'start': 'Commencer le jeu',
                'moves': 'Coups:',
                'player': 'Joueur:',
                'pairs': 'Paires:',
                'reset': 'Réinitialiser',
                'congratulations': 'Félicitations! Vous avez gagné!',
                'finalScore': 'Score final',
                'finalMoves': 'Nombre de coups:',
                'timeLeft': 'Temps restant:',
                'seconds': 'secondes',
                'playAgain': 'Jouer à nouveau',
                'share': 'Partager le score',
                'bestScores': 'Meilleurs scores:',
                'instructions': 'Instructions',
                'cardTheme': 'Choisissez le thème des cartes:',
                'themeDefault': 'Traditionnel',
                'themeZellige': 'Zellige',
                'themePottery': 'Poterie',
                'themeCarpet': 'Tapis',
                'twoPlayerMode': 'Mode deux joueurs',
                'sound': 'Son',
                'player1Wins': 'Joueur 1 gagne!',
                'player2Wins': 'Joueur 2 gagne!',
                'tie': 'Match nul!',
                'score': 'Score:',
                'goldMedal': 'Médaille d\'or',
                'silverMedal': 'Médaille d\'argent',
                'bronzeMedal': 'Médaille de bronze',
                'gameOver': 'Temps écoulé! Essayez à nouveau.'
            },
            'en': {
                'difficulty': 'Choose difficulty level:',
                'easy': 'Easy',
                'medium': 'Medium',
                'hard': 'Hard',
                'start': 'Start Game',
                'moves': 'Moves:',
                'player': 'Player:',
                'pairs': 'Pairs:',
                'reset': 'Reset',
                'congratulations': 'Congratulations! You won!',
                'finalScore': 'Final Score',
                'finalMoves': 'Number of moves:',
                'timeLeft': 'Time remaining:',
                'seconds': 'seconds',
                'playAgain': 'Play Again',
                'share': 'Share Score',
                'bestScores': 'Best Scores:',
                'instructions': 'Instructions',
                'cardTheme': 'Choose card theme:',
                'themeDefault': 'Traditional',
                'themeZellige': 'Zellige',
                'themePottery': 'Pottery',
                'themeCarpet': 'Carpet',
                'twoPlayerMode': 'Two Player Mode',
                'sound': 'Sound',
                'player1Wins': 'Player 1 wins!',
                'player2Wins': 'Player 2 wins!',
                'tie': 'It\'s a tie!',
                'score': 'Score:',
                'goldMedal': 'Gold Medal',
                'silverMedal': 'Silver Medal',
                'bronzeMedal': 'Bronze Medal',
                'gameOver': 'Time\'s up! Try again.'
            }
        };
        
        // Moroccan themed items (icons and names)
        this.moroccanItems = [
            { id: 1, name: 'شاي', emoji: '🍵' }, // Moroccan tea
            { id: 2, name: 'طاجين', emoji: '🍲' }, // Tagine
            { id: 3, name: 'باب تقليدي', emoji: '🚪' }, // Traditional door
            { id: 4, name: 'سجادة', emoji: '🧶' }, // Carpet
            { id: 5, name: 'فانوس', emoji: '🏮' }, // Lantern
            { id: 6, name: 'زيتون', emoji: '🫒' }, // Olives
            { id: 7, name: 'نعناع', emoji: '🌿' }, // Mint
            { id: 8, name: 'جمل', emoji: '🐪' }, // Camel
            { id: 9, name: 'كسكس', emoji: '🥘' }, // Couscous
            { id: 10, name: 'تمر', emoji: '🌴' }, // Date palm
            { id: 11, name: 'برتقال', emoji: '🍊' }, // Orange
            { id: 12, name: 'عود', emoji: '🎵' }, // Oud (music)
            { id: 13, name: 'فاس', emoji: '🏯' }, // Fez (city)
            { id: 14, name: 'قفطان', emoji: '👘' }, // Kaftan
            { id: 15, name: 'بابوش', emoji: '👞' }, // Babouche slippers
            { id: 16, name: 'دار', emoji: '🏠' }, // Riad
        ];
        
        // Sound files (for actual implementation)
        this.sounds = {
            flip: null,
            match: null,
            victory: null,
            timeWarning: null,
            gameOver: null
        };
        
        // Initialize the game
        this.init();
        this.loadSounds();
    }
    
    // Initialize game event listeners
    init() {
        // Sound toggle
        this.soundToggle.addEventListener('click', () => {
            this.soundEnabled = !this.soundEnabled;
            this.soundToggle.querySelector('.sound-icon').textContent = this.soundEnabled ? '🔊' : '🔇';
            this.updateTexts();
        });
        
        // Language selector
        this.languageSelect.addEventListener('change', () => {
            this.language = this.languageSelect.value;
            this.updateTexts();
        });
        
        // Two player mode toggle
        this.twoPlayerMode.addEventListener('change', () => {
            this.isTwoPlayerMode = this.twoPlayerMode.checked;
            this.updateTexts();
        });
        
        // Difficulty buttons
        const difficultyBtns = document.querySelectorAll('[data-difficulty]');
        difficultyBtns.forEach(btn => {
            btn.addEventListener('click', () => {
                // Update active button styling
                difficultyBtns.forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                // Set difficulty
                this.difficulty = btn.dataset.difficulty;
            });
        });
        
        // Card theme options
        const themeOptions = document.querySelectorAll('.card-theme-option');
        themeOptions.forEach(option => {
            option.addEventListener('click', () => {
                // Update active option styling
                themeOptions.forEach(opt => opt.classList.remove('active'));
                option.classList.add('active');
                
                // Set card theme
                this.cardTheme = option.dataset.theme;
            });
        });
        
        // Help button
        document.getElementById('helpBtn').addEventListener('click', () => {
            this.showInstructions();
        });
        
        // Close instructions button
        document.getElementById('closeInstructionsBtn').addEventListener('click', () => {
            this.instructionsModal.style.display = 'none';
        });
        
        // Start button
        document.getElementById('startBtn').addEventListener('click', () => {
            this.startGame();
        });
        
        // Reset button
        document.getElementById('resetBtn').addEventListener('click', () => {
            this.showDifficultyScreen();
        });
        
        // Play again button
        document.getElementById('playAgainBtn').addEventListener('click', () => {
            this.startGame();
        });
        
        // Share button
        document.getElementById('shareBtn').addEventListener('click', () => {
            this.shareScore();
        });
        
        // When clicking outside the modal, close it
        this.instructionsModal.addEventListener('click', (e) => {
            if (e.target === this.instructionsModal) {
                this.instructionsModal.style.display = 'none';
            }
        });
        
        // Update texts to initial language
        this.updateTexts();
    }
    
    // Load sound files
    loadSounds() {
        // This would be implemented with actual sound files in production
        // Example:
        /*
        const soundFiles = {
            flip: 'sounds/darbuka-tap.mp3',
            match: 'sounds/qraqeb-shake.mp3',
            victory: 'sounds/oud-melody.mp3',
            timeWarning: 'sounds/time-warning.mp3',
            gameOver: 'sounds/game-over.mp3'
        };
        
        for (const [key, path] of Object.entries(soundFiles)) {
            const audio = new Audio();
            audio.src = path;
            this.sounds[key] = audio;
        }
        */
    }
    
    // Update texts based on selected language
    updateTexts() {
        const t = this.translations[this.language];
        
        // Update static texts
        document.querySelector('.difficulty-selector p').textContent = t.difficulty;
        document.querySelector('.btn-easy').textContent = t.easy;
        document.querySelector('.btn-medium').textContent = t.medium;
        document.querySelector('.btn-hard').textContent = t.hard;
        document.querySelector('.btn-start').textContent = t.start;
        document.querySelector('.mode-text').textContent = t.twoPlayerMode;
        document.querySelector('.card-theme-selector p').textContent = t.cardTheme;
        document.querySelectorAll('.card-theme-option')[0].textContent = t.themeDefault;
        document.querySelectorAll('.card-theme-option')[1].textContent = t.themeZellige;
        document.querySelectorAll('.card-theme-option')[2].textContent = t.themePottery;
        document.querySelectorAll('.card-theme-option')[3].textContent = t.themeCarpet;
        document.querySelector('.btn-help').textContent = t.instructions;
        document.querySelector('.btn-reset').textContent = t.reset;
        document.querySelector('.sound-text').textContent = t.sound;
        
        // Update game stats labels
        const moveLabel = document.querySelector('.game-stats div:nth-child(1)');
        if (moveLabel) moveLabel.textContent = `${t.moves} ${this.moves}`;
        
        const playerLabel = document.querySelector('.game-stats div:nth-child(2)');
        if (playerLabel) playerLabel.textContent = `${t.player} ${this.currentPlayer}`;
        
        const pairsLabel = document.querySelector('.game-stats div:nth-child(3)');
        if (pairsLabel) {
            const found = this.pairsFound ? this.pairsFound.textContent : '0';
            const total = this.totalPairs ? this.totalPairs.textContent : '0';
            pairsLabel.textContent = `${t.pairs} ${found}/${total}`;
        }
        
        // Update win screen texts
        document.querySelector('.win-title').textContent = t.congratulations;
        document.querySelector('.score-title').textContent = t.finalScore;
        document.querySelector('#highscoreSection h3').textContent = t.bestScores;
        document.querySelector('.btn-share').textContent = t.share;
        document.querySelector('#playAgainBtn').textContent = t.playAgain;
        
        // Update win stats format
        const movesText = document.querySelector('.win-stats').firstChild;
        if (movesText) movesText.textContent = `${t.finalMoves} `;
        
        const timeText = document.querySelector('.win-stats').childNodes[2];
        if (timeText) timeText.textContent = ` ${t.timeLeft} `;
        
        // Update seconds text
        const secondsText = document.querySelector('.win-stats').lastChild;
        if (secondsText) secondsText.textContent = ` ${t.seconds}`;
    }
    
    // Show instructions modal
    showInstructions() {
        this.instructionsModal.style.display = 'flex';
    }
    
    // Start a new game
    startGame() {
        // Reset game state
        this.cards = [];
        this.flippedCards = [];
        this.matchedPairs = [];
        this.moves = 0;
        this.isLocked = false;
        this.currentPlayer = 1;
        this.playerScores = { 1: 0, 2: 0 };
        
        // Set timer based on difficulty
        switch(this.difficulty) {
            case 'easy':
                this.timeLeft = 90; // 90 seconds for easy
                break;
            case 'hard':
                this.timeLeft = 45; // 45 seconds for hard
                break;
            case 'medium':
            default:
                this.timeLeft = 60; // 60 seconds for medium
        }
        
        // Create and shuffle cards
        this.createCards();
        
        // Update UI
        this.updateStats();
        this.updateTimerDisplay();
        
        // Show game screen
        this.difficultyScreen.style.display = 'none';
        this.winScreen.style.display = 'none';
        this.gameScreen.style.display = 'block';
        
        // Add theme class to game board
        this.gameBoard.className = 'game-board';
        this.gameBoard.classList.add(`grid-${this.difficulty}`);
        this.gameBoard.classList.add(`theme-${this.cardTheme}`);
        
        // Render cards
        this.renderCards();
        
        // Start timer
        this.startTimer();
    }
    
    // Start the game timer
    startTimer() {
        // Clear any existing timer
        if (this.timerInterval) {
            clearInterval(this.timerInterval);
        }
        
        const startTime = this.timeLeft;
        this.updateTimerDisplay();
        
        this.timerInterval = setInterval(() => {
            this.timeLeft--;
            
            // Update timer display
            this.updateTimerDisplay();
            
            // Check for low time warning (10 seconds or less)
            if (this.timeLeft <= 10) {
                this.timerBar.style.backgroundColor = '#ef4444'; // Red for warning
                
                // Play warning sound if not already played
                if (this.timeLeft === 10) {
                    this.playSound('timeWarning');
                }
            }
            
            // Check if time is up
            if (this.timeLeft <= 0) {
                clearInterval(this.timerInterval);
                this.endGame(false); // End game as loss
            }
        }, 1000);
    }
    
    // Update timer display
    updateTimerDisplay() {
        const totalTime = this.difficulty === 'easy' ? 90 : (this.difficulty === 'hard' ? 45 : 60);
        const percentage = (this.timeLeft / totalTime) * 100;
        
        this.timerBar.style.width = `${percentage}%`;
        this.timerText.textContent = this.timeLeft;
        
        // Set color based on remaining time
        if (this.timeLeft <= 10) {
            this.timerBar.style.backgroundColor = '#ef4444'; // Red
        } else if (this.timeLeft <= 30) {
            this.timerBar.style.backgroundColor = '#f59e0b'; // Amber
        } else {
            this.timerBar.style.backgroundColor = '#16a34a'; // Green
        }
    }
    
    // Create card deck based on difficulty
    createCards() {
        let pairsCount;
        
        // Set number of pairs based on difficulty
        switch(this.difficulty) {
            case 'easy':
                pairsCount = 6;
                break;
            case 'hard':
                pairsCount = 12;
                break;
            case 'medium':
            default:
                pairsCount = 8;
        }
        
        // Update total pairs in UI
        this.totalPairs.textContent = pairsCount;
        
        // Get subset of items based on difficulty
        const selectedItems = this.moroccanItems.slice(0, pairsCount);
        
        // Create pairs
        this.cards = [];
        selectedItems.forEach(item => {
            // Create two cards with same id (pairs)
            this.cards.push({ ...item, isFlipped: false, isMatched: false });
            this.cards.push({ ...item, isFlipped: false, isMatched: false });
        });
        
        // Shuffle cards
        this.shuffleCards();
    }
    
    // Shuffle the cards
    shuffleCards() {
        for (let i = this.cards.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [this.cards[i], this.cards[j]] = [this.cards[j], this.cards[i]];
        }
    }
    
    // Render cards on the game board
    renderCards() {
        // Clear game board
        this.gameBoard.innerHTML = '';
        
        // Create card elements
        this.cards.forEach((card, index) => {
            const cardElement = document.createElement('div');
            cardElement.className = 'card';
            if (card.isFlipped) cardElement.classList.add('flipped');
            if (card.isMatched) cardElement.classList.add('matched');
            
            cardElement.innerHTML = `
                <div class="card-face card-back"></div>
                <div class="card-face card-front">${card.emoji}</div>
            `;
            
            // Add click event
            cardElement.addEventListener('click', () => this.flipCard(index));
            
            // Add to game board
            this.gameBoard.appendChild(cardElement);
        });
    }
    
    // Card flip handler
    flipCard(index) {
        const card = this.cards[index];
        
        // Prevent flipping in these cases
        if (this.isLocked || card.isFlipped || card.isMatched) {
            return;
        }
        
        // Flip the card
        card.isFlipped = true;
        this.flippedCards.push({ index, id: card.id });
        
        // Play flip sound
        this.playSound('flip');
        
        // Update the UI
        this.renderCards();
        
        // Check if two cards are flipped
        if (this.flippedCards.length === 2) {
            this.isLocked = true;
            this.moves++;
            this.updateStats();
            
            // Check for match
            setTimeout(() => {
                this.checkForMatch();
            }, 800);
        }
    }
    
    // Check if the two flipped cards match
    checkForMatch() {
        const [first, second] = this.flippedCards;
        
        if (first.id === second.id) {
            // Match found
            this.cards[first.index].isMatched = true;
            this.cards[second.index].isMatched = true;
            this.matchedPairs.push(first.id);
            
            // Update player scores in two player mode
            if (this.isTwoPlayerMode) {
                this.playerScores[this.currentPlayer]++;
            }
            
            // Add animation class to matched cards
            const cardElements = document.querySelectorAll('.card');
            cardElements[first.index].classList.add('matched-animation');
            cardElements[second.index].classList.add('matched-animation');
            
            // Play match sound
            this.playSound('match');
            
            // Update stats
            this.pairsFound.textContent = this.matchedPairs.length;
            
            // Check for win
            if (this.matchedPairs.length === parseInt(this.totalPairs.textContent)) {
                // Stop the timer
                clearInterval(this.timerInterval);
                
                setTimeout(() => {
                    this.endGame(true); // Win game
                }, 500);
            } else {
                // Current player gets another turn in two player mode if matched
                if (!this.isTwoPlayerMode) {
                    // Reset for next turn
                    this.flippedCards = [];
                    this.isLocked = false;
                } else {
                    // Player continues after a match
                    this.flippedCards = [];
                    this.isLocked = false;
                }
            }
        } else {
            // No match, flip cards back
            this.cards[first.index].isFlipped = false;
            this.cards[second.index].isFlipped = false;
            
            // Switch player in two player mode
            if (this.isTwoPlayerMode) {
                this.currentPlayer = this.currentPlayer === 1 ? 2 : 1;
                this.updateStats();
            }
            
            // Reset flipped cards array
            this.flippedCards = [];
            this.isLocked = false;
        }
        
        // Update UI
        this.renderCards();
    }
    
    // Update game stats
    updateStats() {
        this.moveCount.textContent = this.moves;
        this.pairsFound.textContent = this.matchedPairs.length;
        
        if (this.isTwoPlayerMode) {
            this.currentPlayerDisplay.textContent = this.currentPlayer;
        }
    }
    
    // End game function (handles both win and loss)
    endGame(isWin) {
        // Stop the timer
        clearInterval(this.timerInterval);
        
        if (isWin) {
            // Calculate score based on moves, remaining time, and difficulty
            let difficultyMultiplier;
            switch(this.difficulty) {
                case 'easy':
                    difficultyMultiplier = 1;
                    break;
                case 'medium':
                    difficultyMultiplier = 2;
                    break;
                case 'hard':
                    difficultyMultiplier = 3;
                    break;
            }
            
            // Formula: (pairs * 100) + (remaining time * 10) - (moves * 5) * difficultyMultiplier
            const pairsPoints = parseInt(this.totalPairs.textContent) * 100;
            const timePoints = this.timeLeft * 10;
            const movesPenalty = this.moves * 5;
            
            this.score = Math.max(0, (pairsPoints + timePoints - movesPenalty) * difficultyMultiplier);
            
            // In two player mode, determine the winner
            if (this.isTwoPlayerMode) {
                if (this.playerScores[1] > this.playerScores[2]) {
                    document.querySelector('.win-title').textContent = this.translations[this.language].player1Wins;
                } else if (this.playerScores[2] > this.playerScores[1]) {
                    document.querySelector('.win-title').textContent = this.translations[this.language].player2Wins;
                } else {
                    document.querySelector('.win-title').textContent = this.translations[this.language].tie;
                }
            }
            
            // Play victory sound
            this.playSound('victory');
            
            // Update win screen stats
            this.finalMoves.textContent = this.moves;
            this.finalTime.textContent = this.timeLeft;
            this.finalScore.textContent = this.score;
            
            // Display appropriate medal based on score
            this.displayMedal();
            
            // Add to high scores
            this.addToHighScores();
            
            // Create celebration animation
            this.createCelebrationEffect();
            
            // Show win screen
            this.gameScreen.style.display = 'none';
            this.winScreen.style.display = 'block';
        } else {
            // Game over (time ran out)
            this.playSound('gameOver');
            alert(this.translations[this.language].gameOver);
            this.showDifficultyScreen();
        }
    }
    
    // Display medal based on score
    displayMedal() {
        this.medalContainer.innerHTML = '';
        
        let medal, medalText;
        const totalPairs = parseInt(this.totalPairs.textContent);
        const maxPossibleScore = (totalPairs * 100 + (this.difficulty === 'easy' ? 90 : (this.difficulty === 'hard' ? 45 : 60)) * 10) * 
                                (this.difficulty === 'easy' ? 1 : (this.difficulty === 'hard' ? 3 : 2));
        
        // Determine medal based on percentage of max possible score
        const scorePercentage = (this.score / maxPossibleScore) * 100;
        
        if (scorePercentage >= 80) {
            medal = 'medal-gold';
            medalText = this.translations[this.language].goldMedal;
        } else if (scorePercentage >= 60) {
            medal = 'medal-silver';
            medalText = this.translations[this.language].silverMedal;
        } else {
            medal = 'medal-bronze';
            medalText = this.translations[this.language].bronzeMedal;
        }
        
        const medalElement = document.createElement('div');
        medalElement.className = `medal ${medal}`;
        medalElement.textContent = medalText;
        
        this.medalContainer.appendChild(medalElement);
    }
    
    // Add score to high scores
    addToHighScores() {
        // Get existing high scores from local storage
        let highScores = JSON.parse(localStorage.getItem('moroccanMemoryHighScores') || '[]');
        
        // Add current score
        highScores.push({
            difficulty: this.difficulty,
            score: this.score,
            moves: this.moves,
            timeLeft: this.timeLeft,
            date: new Date().toISOString()
        });
        
        // Sort by score (highest first)
        highScores.sort((a, b) => b.score - a.score);
        
        // Keep only top 10
        highScores = highScores.slice(0, 10);
        
        // Save back to local storage
        localStorage.setItem('moroccanMemoryHighScores', JSON.stringify(highScores));
        
        // Display high scores
        this.displayHighScores(highScores);
    }
    
    // Display high scores on win screen
    displayHighScores(highScores) {
        this.highscoresContainer.innerHTML = '';
        
        highScores.forEach((entry, index) => {
            const scoreItem = document.createElement('div');
            scoreItem.className = 'highscore-item';
            
            // Format the difficulty text using translations
            const difficultyText = this.translations[this.language][entry.difficulty] || entry.difficulty;
            
            scoreItem.innerHTML = `
                <div>${index + 1}. ${difficultyText}</div>
                <div>${entry.score}</div>
            `;
            
            this.highscoresContainer.appendChild(scoreItem);
        });
    }
    
    // Create confetti celebration effect
    createCelebrationEffect() {
        const celebrationContainer = document.getElementById('celebrationAnimation');
        celebrationContainer.innerHTML = '';
        
        // Generate 50 confetti pieces
        for (let i = 0; i < 50; i++) {
            setTimeout(() => {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                
                // Random color
                const colors = ['#16a34a', '#b45309', '#0ea5e9', '#ec4899', '#8b5cf6'];
                const randomColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.setProperty('--color', randomColor);
                
                // Random position
                confetti.style.left = `${Math.random() * 100}%`;
                
                // Random delay
                const delay = Math.random() * 0.5;
                confetti.style.animationDelay = `${delay}s`;
                
                celebrationContainer.appendChild(confetti);
                
                // Remove confetti after animation
                setTimeout(() => {
                    confetti.remove();
                }, 3000);
            }, i * 50); // Stagger effect
        }
    }
    
    // Share score (would be implemented to share on social media)
    shareScore() {
        // Get formatted difficulty
        const difficultyText = this.translations[this.language][this.difficulty];
        
        // Create share text
        const shareText = `${this.translations[this.language].score} ${this.score} - ${difficultyText} - ${this.translations[this.language].moves} ${this.moves}`;
        
        // In a real implementation, this would use the Web Share API or similar
        alert(shareText);
        
        // Example of Web Share API:
        /*
        if (navigator.share) {
            navigator.share({
                title: 'My Moroccan Memory Game Score',
                text: shareText,
                url: window.location.href
            })
            .catch(error => console.log('Error sharing:', error));
        } else {
            // Fallback - perhaps copy to clipboard
            const tempInput = document.createElement('input');
            document.body.appendChild(tempInput);
            tempInput.value = shareText;
            tempInput.select();
            document.execCommand('copy');
            document.body.removeChild(tempInput);
            alert('Score copied to clipboard!');
        }
        */
    }
    
    // Show difficulty screen
    showDifficultyScreen() {
        // Stop any running timer
        if (this.timerInterval) {
            clearInterval(this.timerInterval);
        }
        
        this.gameScreen.style.display = 'none';
        this.winScreen.style.display = 'none';
        this.difficultyScreen.style.display = 'block';
    }
    
    // Play sound effect
    playSound(type) {
        // Only play sound if enabled
        if (!this.soundEnabled) return;
        
        console.log(`Playing ${type} sound`);
        
        // In a real implementation, would play actual sounds here
        if (this.sounds[type]) {
            this.sounds[type].currentTime = 0; // Reset to start
            this.sounds[type].play().catch(e => console.log('Error playing sound:', e));
        }
    }
}

// Sound Manager Class for audio effects
class SoundManager {
    constructor() {
        // Check if AudioContext is supported
        if (window.AudioContext || window.webkitAudioContext) {
            this.audioContext = new (window.AudioContext || window.webkitAudioContext)();
            this.sounds = {};
            this.buffers = {};
            
            // Moroccan instrument sounds (would be loaded from actual files)
            /*
            this.loadSound('flip', 'sounds/darbuka-tap.mp3');
            this.loadSound('match', 'sounds/qraqeb-shake.mp3'); 
            this.loadSound('victory', 'sounds/oud-melody.mp3');
            this.loadSound('timeWarning', 'sounds/bendir-warning.mp3');
            this.loadSound('gameOver', 'sounds/gameOver.mp3');
            */
        }
    }
    
    // Load a sound file
    loadSound(name, url) {
        fetch(url)
            .then(response => response.arrayBuffer())
            .then(arrayBuffer => this.audioContext.decodeAudioData(arrayBuffer))
            .then(audioBuffer => {
                this.buffers[name] = audioBuffer;
            })
            .catch(error => console.error('Error loading sound:', error));
    }
    
    // Play a loaded sound
    play(name) {
        if (this.buffers[name]) {
            const source = this.audioContext.createBufferSource();
            source.buffer = this.buffers[name];
            
            // Create gain node for volume control
            const gainNode = this.audioContext.createGain();
            gainNode.gain.value = 0.7; // Set volume to 70%
            
            // Connect the source to the gain node and then to the destination
            source.connect(gainNode);
            gainNode.connect(this.audioContext.destination);
            
            // Start playing
            source.start(0);
            
            return source;
        }
        return null;
    }
}

// Initialize the game when the page loads
document.addEventListener('DOMContentLoaded', () => {
    new MoroccanMemoryGame();
});
    
</script>
</body>
</html>